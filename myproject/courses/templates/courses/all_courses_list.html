{% extends 'layout.html' %}
{% load static %}

{% block specific_styles %}
<style>
    .courses-page {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    .courses-header {
        text-align: center;
        margin-bottom: 2.5rem;
    }

    .courses-header h1 {
        font-size: 2.2rem;
        color: var(--accent-blue);
        font-weight: 700;
        margin-bottom: 0.5rem;
        border: none;
        padding: 0;
    }

    .courses-header p {
        font-size: 1.1rem;
        color: #6c757d;
    }

    /* Сетка карточек */
    .courses-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 1.5rem;
    }

    /* Карточка курса */
    .course-card {
        background: #fff;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        border: 1px solid #e9ecef;
    }

    .course-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 8px 30px rgba(0, 82, 163, 0.15);
    }

    /* Изображение курса */
    .course-card__image-wrapper {
        position: relative;
        width: 100%;
        height: 200px;
        overflow: hidden;
        background: linear-gradient(135deg, var(--light-blue) 0%, #cce0ff 100%);
    }

    .course-card__image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.4s ease;
    }

    .course-card:hover .course-card__image {
        transform: scale(1.05);
    }

    .course-card__placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--secondary-color);
        font-size: 3.5rem;
    }

    /* Бейдж статуса */
    .course-card__status {
        position: absolute;
        top: 12px;
        right: 12px;
        padding: 5px 14px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        letter-spacing: 0.3px;
        backdrop-filter: blur(4px);
    }

    .course-card__status--completed {
        background: rgba(25, 135, 84, 0.9);
        color: #fff;
    }

    .course-card__status--in-progress {
        background: rgba(255, 193, 7, 0.9);
        color: #212529;
    }

    .course-card__status--not-started {
        background: rgba(108, 117, 125, 0.85);
        color: #fff;
    }

    /* Контент карточки */
    .course-card__body {
        padding: 1.25rem 1.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .course-card__title {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--text-color);
        margin-bottom: 0.75rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Метаинформация */
    .course-card__meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
        color: #6c757d;
        font-size: 0.9rem;
    }

    .course-card__meta-item {
        display: flex;
        align-items: center;
        gap: 0.35rem;
    }

    .course-card__meta-item i {
        font-size: 1rem;
        color: var(--secondary-color);
    }

    /* Прогресс-бар */
    .course-card__progress-wrapper {
        margin-bottom: 1rem;
        margin-top: auto;
    }

    .course-card__progress-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.4rem;
        font-size: 0.82rem;
        color: #6c757d;
    }

    .course-card__progress-bar {
        width: 100%;
        height: 8px;
        background: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
    }

    .course-card__progress-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 0.6s ease;
        background: linear-gradient(90deg, var(--secondary-color), var(--accent-blue));
    }

    .course-card__progress-fill--completed {
        background: linear-gradient(90deg, #198754, #20c997);
    }

    /* Кнопка */
    .course-card__footer {
        padding: 0 1.5rem 1.25rem;
    }

    .course-card__btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        width: 100%;
        padding: 0.7rem 1rem;
        border: none;
        border-radius: 10px;
        font-size: 0.95rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.25s ease;
        cursor: pointer;
    }

    .course-card__btn--primary {
        background: var(--secondary-color);
        color: #fff;
    }

    .course-card__btn--primary:hover {
        background: var(--accent-blue);
        color: #fff;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
    }

    .course-card__btn--success {
        background: #198754;
        color: #fff;
    }

    .course-card__btn--success:hover {
        background: #157347;
        color: #fff;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(25, 135, 84, 0.3);
    }

    /* Пустое состояние */
    .courses-empty {
        text-align: center;
        padding: 4rem 2rem;
        background: var(--light-blue);
        border-radius: 16px;
        border: 2px dashed var(--secondary-color);
    }

    .courses-empty__icon {
        font-size: 4rem;
        color: var(--secondary-color);
        margin-bottom: 1rem;
    }

    .courses-empty__title {
        font-size: 1.5rem;
        color: var(--accent-blue);
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .courses-empty__text {
        font-size: 1.05rem;
        color: #6c757d;
        max-width: 500px;
        margin: 0 auto;
    }

    /* Адаптивность */
    @media (max-width: 768px) {
        .courses-grid {
            grid-template-columns: 1fr;
        }

        .courses-header h1 {
            font-size: 1.6rem !important;
        }

        .course-card__image-wrapper {
            height: 170px;
        }
    }

    @media (max-width: 512px) {
        .courses-grid {
            gap: 1rem;
        }

        .course-card__body {
            padding: 1rem 1.1rem;
        }

        .course-card__footer {
            padding: 0 1.1rem 1rem;
        }

        .course-card__title {
            font-size: 1.05rem !important;
        }

        .course-card__image-wrapper {
            height: 150px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="courses-page">
    <div class="courses-header">
        <h1>Мои курсы</h1>
        <p>Ваши назначенные и пройденные курсы</p>
    </div>

    {% if has_courses %}
        <div class="courses-grid">
            {% for item in courses_data %}
            <div class="course-card">
                <!-- Изображение -->
                <div class="course-card__image-wrapper">
                    {% if item.course.image %}
                        <img src="{{ item.course.image.url }}" alt="{{ item.course.title }}" class="course-card__image">
                    {% else %}
                        <div class="course-card__placeholder">
                            <i class="bi bi-book"></i>
                        </div>
                    {% endif %}

                    <!-- Статус -->
                    {% if item.is_completed %}
                        <span class="course-card__status course-card__status--completed">
                            <i class="bi bi-check-circle-fill"></i> Завершён
                        </span>
                    {% elif item.progress > 0 %}
                        <span class="course-card__status course-card__status--in-progress">
                            <i class="bi bi-play-circle-fill"></i> В процессе
                        </span>
                    {% else %}
                        <span class="course-card__status course-card__status--not-started">
                            Не начат
                        </span>
                    {% endif %}
                </div>

                <!-- Тело карточки -->
                <div class="course-card__body">
                    <div class="course-card__title">{{ item.course.title }}</div>

                    <div class="course-card__meta">
                        {% if item.total_lessons > 0 %}
                        <span class="course-card__meta-item">
                            <i class="bi bi-journal-text"></i>
                            {{ item.total_lessons }} 
                            {% if item.total_lessons == 1 %}урок{% elif item.total_lessons < 5 %}урока{% else %}уроков{% endif %}
                        </span>
                        {% endif %}
                        {% if item.total_quizzes > 0 %}
                        <span class="course-card__meta-item">
                            <i class="bi bi-question-circle"></i>
                            {{ item.total_quizzes }}
                            {% if item.total_quizzes == 1 %}тест{% elif item.total_quizzes < 5 %}теста{% else %}тестов{% endif %}
                        </span>
                        {% endif %}
                        <span class="course-card__meta-item">
                            <i class="bi bi-layers"></i>
                            {{ item.total_materials }}
                            {% if item.total_materials == 1 %}материал{% elif item.total_materials < 5 %}материала{% else %}материалов{% endif %}
                        </span>
                    </div>

                    <!-- Прогресс -->
                    <div class="course-card__progress-wrapper">
                        <div class="course-card__progress-info">
                            <span>Прогресс</span>
                            <span>{{ item.progress }}%</span>
                        </div>
                        <div class="course-card__progress-bar">
                            <div class="course-card__progress-fill {% if item.is_completed %}course-card__progress-fill--completed{% endif %}"
                                 style="width: {{ item.progress }}%;"></div>
                        </div>
                    </div>
                </div>

                <!-- Кнопка -->
                <div class="course-card__footer">
                    {% if item.is_completed %}
                        <a href="{% url 'courses:course_detail' item.course.slug %}"
                           class="course-card__btn course-card__btn--success">
                            <i class="bi bi-arrow-right-circle"></i>
                            Просмотреть курс
                        </a>
                    {% else %}
                        <a href="{% url 'courses:course_detail' item.course.slug %}"
                           class="course-card__btn course-card__btn--primary">
                            <i class="bi bi-arrow-right-circle"></i>
                            Перейти к курсу
                        </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="courses-empty">
            <div class="courses-empty__icon">
                <i class="bi bi-mortarboard"></i>
            </div>
            <div class="courses-empty__title">Курсов пока нет</div>
            <p class="courses-empty__text">
                Вам ещё не назначили ни одного курса. Обратитесь к администрации сайта для получения доступа к обучающим материалам.
            </p>
        </div>
    {% endif %}
</div>
{% endblock %}
